(()=>{var e={};e.id=20,e.ids=[20],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},52316:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>g,serverHooks:()=>y,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>w});var i={};r.r(i),r.d(i,{GET:()=>l,POST:()=>m});var a=r(42706),s=r(28203),n=r(45994),c=r(98811),d=r(55511),o=r.n(d),u=r(39187),p=r(61810);async function l(e){try{let t=e.cookies.get("cartToken")?.value;if(!t)return u.NextResponse.json({totalAmount:0,items:[]});let r=await p.z.cart.findFirst({where:{OR:[{token:t}]},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}});return u.NextResponse.json(r)}catch(e){return console.log("[CART_GET] Server error",e),u.NextResponse.json({message:"Не удалось получить корзину"},{status:500})}}async function m(e){try{let t=e.cookies.get("cartToken")?.value;t||(t=o().randomUUID());let r=await (0,c.bF)(t),i=await e.json(),a=await p.z.cartItem.findFirst({where:{cartId:r.id,productItemId:i.productItemId,ingredients:{every:{id:{in:i.ingredients}},some:{}}},include:{ingredients:!0}});a?await p.z.cartItem.update({where:{id:a.id},data:{quantity:a.quantity+1}}):await p.z.cartItem.create({data:{cartId:r.id,productItemId:i.productItemId,quantity:1,ingredients:{connect:i.ingredients?.map(e=>({id:e}))}}});let s=await (0,c.qm)(t),n=u.NextResponse.json(s);return n.cookies.set("cartToken",t),n}catch(e){return console.log("[CART_POST] Server error",e),u.NextResponse.json({message:"Не удалось создать корзину"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"E:\\proj\\tutorials\\next-pizza-main\\src\\app\\api\\cart\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:x,workUnitAsyncStorage:w,serverHooks:y}=g;function v(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:w})}},96487:()=>{},78335:()=>{},61810:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var i=r(96330);let a=global.prisma||new i.PrismaClient},98811:(e,t,r)=>{"use strict";r.d(t,{bF:()=>a,qm:()=>n});var i=r(61810);let a=async e=>{let t=await i.z.cart.findFirst({where:{token:e}});return t||(t=await i.z.cart.create({data:{token:e}})),t};Object.entries({20:"Маленькая",30:"Средняя",40:"Большая"}).map(([e,t])=>({name:t,value:e})),Object.entries({1:"традиционная",2:"тонкая"}).map(([e,t])=>({name:t,value:e}));let s=e=>(e.ingredients.reduce((e,t)=>e+t.price,0)+e.productItem.price)*e.quantity,n=async e=>{let t=await i.z.cart.findFirst({where:{token:e},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}});if(!t)return;let r=t.items.reduce((e,t)=>e+s(t),0);return await i.z.cart.update({where:{id:t.id},data:{totalAmount:r},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{product:!0}},ingredients:!0}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[638,452],()=>r(52316));module.exports=i})();